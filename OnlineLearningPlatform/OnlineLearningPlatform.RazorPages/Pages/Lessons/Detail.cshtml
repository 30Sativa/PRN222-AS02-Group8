@page "{id:int}"

@model OnlineLearningPlatform.RazorPages.Pages.Lessons.DetailModel

@using OnlineLearningPlatform.Models.Entities

@{

    ViewData["Title"] = "Lesson Detail";

}



@if (Model.Lesson is null)

{

    <div class="alert alert-warning">Lesson not found.</div>

}

else

{

    <div class="d-flex justify-content-between align-items-start mb-3">

        <div>

            <h2 class="mb-1">@Model.Lesson.Title</h2>

            <div class="text-muted">Type: @Model.Lesson.LessonType</div>

        </div>

        <a class="btn btn-outline-secondary" href="javascript:history.back()">Back</a>

    </div>



    @switch (Model.Lesson.LessonType)

    {

        case LessonType.Video:

            <div class="card shadow-sm border-0">

                <div class="card-body">

                    @if (!string.IsNullOrWhiteSpace(Model.Lesson.VideoStoragePath))

                    {

                        <video class="w-100" controls preload="metadata" style="max-height: 560px; background: #000;">

                            <source src="@Model.Lesson.VideoStoragePath" type="video/mp4" />

                            Your browser does not support the video tag.

                        </video>



                    }

                    else

                    {

                        <div class="alert alert-info mb-0">Video is not available for this lesson yet.</div>

                    }

                </div>

            </div>

            break;



        case LessonType.Reading:

            <div class="card shadow-sm border-0">

                <div class="card-body">

                    @if (!string.IsNullOrWhiteSpace(Model.Lesson.Content))

                    {

                        <div style="white-space: pre-wrap;">@Model.Lesson.Content</div>

                    }

                    else

                    {

                        <div class="alert alert-info mb-0">No reading content available.</div>

                    }

                </div>

            </div>

            break;



        case LessonType.Quiz:

            <div class="card shadow-sm border-0">

                <div class="card-body">

                    @if (Model.Lesson.Quizzes.Any())

                    {

                        <h5 class="mb-3">Quizzes</h5>

                        <div class="list-group">

                            @foreach (var quiz in Model.Lesson.Quizzes)

                            {

                                <div class="list-group-item">

                                    <div class="fw-semibold">@quiz.Title</div>

                                    <div class="small text-muted">

                                        Passing Score: @quiz.PassingScore% 

                                        @if (quiz.TimeLimitMinutes.HasValue)

                                        {

                                            <text> | Time limit: @quiz.TimeLimitMinutes min</text>

                                        }

                                        | Questions: @quiz.Questions.Count

                                    </div>

                                </div>

                            }

                        </div>

                    }

                    else

                    {

                        <div class="alert alert-info mb-0">No quiz has been configured for this lesson yet.</div>

                    }

                </div>

            </div>

            break;



        case LessonType.Assignment:

            <div class="card shadow-sm border-0">

                <div class="card-body">

                    @if (Model.Lesson.Assignments.Any())

                    {

                        <h5 class="mb-3">Assignments</h5>

                        <div class="list-group">

                            @foreach (var assignment in Model.Lesson.Assignments)

                            {

                                <div class="list-group-item">

                                    <div class="fw-semibold">@assignment.Title</div>

                                    @if (!string.IsNullOrWhiteSpace(assignment.Description))

                                    {

                                        <div class="mt-1" style="white-space: pre-wrap;">@assignment.Description</div>

                                    }

                                    <div class="small text-muted mt-1">

                                        Max file size: @assignment.MaxFileSizeMB MB

                                        @if (!string.IsNullOrWhiteSpace(assignment.AllowedFileExtensions))

                                        {

                                            <text> | Allowed: @assignment.AllowedFileExtensions</text>

                                        }

                                        @if (assignment.DueDate.HasValue)

                                        {

                                            <text> | Due: @assignment.DueDate.Value.ToString("dd/MM/yyyy HH:mm")</text>

                                        }

                                    </div>

                                </div>

                            }

                        </div>

                    }

                    else

                    {

                        <div class="alert alert-info mb-0">No assignment has been configured for this lesson yet.</div>

                    }

                </div>

            </div>

            break;



        default:

            <div class="alert alert-warning">Unsupported lesson type.</div>

            break;

    }

}