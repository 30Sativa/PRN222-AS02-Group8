@page
@model OnlineLearningPlatform.RazorPages.Areas.Admin.Pages.Users.IndexModel
@{
    ViewData["Title"] = "Qu·∫£n l√Ω Users";
}

<div class="page-header fade-in">
    <h1>üë• Qu·∫£n l√Ω Ng∆∞·ªùi d√πng</h1>
    <span class="breadcrumb-text">
        <a asp-area="Admin" asp-page="/Dashboard" style="color:var(--primary);">Dashboard</a> ‚Üí Danh s√°ch ng∆∞·ªùi d√πng
    </span>
</div>

<!-- Th√¥ng b√°o -->
@if (Model.SuccessMessage != null)
{
    <div class="olp-alert olp-alert-success fade-in">‚úÖ @Model.SuccessMessage</div>
}
@if (Model.ErrorMessage != null)
{
    <div class="olp-alert olp-alert-danger fade-in">‚ùå @Model.ErrorMessage</div>
}

<!-- Search ƒëa ti√™u ch√≠ -->
<div class="olp-card fade-in mb-2">
    <div class="olp-card-body" style="padding: 1rem 1.5rem;">
        <form method="get" style="display:flex; gap:.75rem; align-items:flex-end; flex-wrap:wrap;">
            <!-- Keyword -->
            <div class="olp-form-group" style="margin-bottom:0; flex:1; min-width:200px;">
                <label style="font-size:.75rem;">üîç T√¨m ki·∫øm</label>
                <input type="text" name="keyword" value="@Model.Keyword" class="olp-form-control" placeholder="Nh·∫≠p t√™n, email, SƒêT..." />
            </div>
            <!-- Filter Role -->
            <div class="olp-form-group" style="margin-bottom:0; min-width:150px;">
                <label style="font-size:.75rem;">üîë L·ªçc Role</label>
                <select name="role" class="olp-form-control">
                    <option value="">T·∫•t c·∫£</option>
                    <option value="Admin" selected="@(Model.Role == "Admin")">Admin</option>
                    <option value="Teacher" selected="@(Model.Role == "Teacher")">Teacher</option>
                    <option value="Student" selected="@(Model.Role == "Student")">Student</option>
                </select>
            </div>
            <!-- N√∫t -->
            <div style="display:flex; gap:.5rem;">
                <button type="submit" class="btn-primary-olp">üîç T√¨m</button>
                <a asp-page="/Users/Index" class="btn-secondary-olp">‚Ü∫ Reset</a>
            </div>
        </form>
    </div>
</div>

<!-- B·∫£ng k·∫øt qu·∫£ -->
<div class="olp-card fade-in">
    <div class="olp-card-header">
        <h2>K·∫øt qu·∫£ (@Model.TotalCount ng∆∞·ªùi d√πng)</h2>
    </div>
    <div class="olp-card-body" style="padding:0;">
        @if (Model.Users.Any())
        {
            <div class="olp-table-wrapper">
                <table class="olp-table">
                    <thead>
                        <tr>
                            <th>Ng∆∞·ªùi d√πng</th>
                            <th>SƒêT</th>
                            <th>Role</th>
                            <th>H√†nh ƒë·ªông</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var user in Model.Users)
                        {
                            var avatarClass = user.Role switch
                            {
                                "Admin" => "avatar-admin",
                                "Teacher" => "avatar-teacher",
                                _ => "avatar-student"
                            };
                            var badgeClass = user.Role switch
                            {
                                "Admin" => "badge-admin",
                                "Teacher" => "badge-teacher",
                                _ => "badge-student"
                            };

                            <tr>
                                <td>
                                    <div class="user-cell">
                                        <div class="avatar @avatarClass">
                                            @(user.FullName?[0].ToString().ToUpper() ?? "U")
                                        </div>
                                        <div class="user-info">
                                            <div class="name">@user.FullName</div>
                                            <div class="email">@user.Email</div>
                                        </div>
                                    </div>
                                </td>
                                <td>@(user.PhoneNumber ?? "‚Äî")</td>
                                <td><span class="badge @badgeClass">@user.Role</span></td>
                                <td>
                                    <div class="btn-group-actions">
                                        <a asp-page="/Users/Detail" asp-route-id="@user.Id"
                                           class="btn-secondary-olp btn-sm">üëÅÔ∏è Xem</a>
                                        <a asp-page="/Users/Edit" asp-route-id="@user.Id"
                                           class="btn-primary-olp btn-sm">‚úèÔ∏è S·ª≠a</a>
                                        <!-- N√∫t x√≥a (c√≥ confirm) -->
                                        <form method="post" asp-page-handler="Delete" asp-route-id="@user.Id"
                                              style="display:inline;"
                                              onsubmit="return confirm('B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a ng∆∞·ªùi d√πng n√†y?');">
                                            <button type="submit" class="btn-sm"
                                                    style="background:#fee2e2;color:#991b1b;border:1px solid #fca5a5;border-radius:6px;padding:.35rem .75rem;font-size:.8rem;cursor:pointer;">
                                                üóëÔ∏è X√≥a
                                            </button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <!-- Ph√¢n trang -->
            @if (Model.TotalPages > 1)
            {
                <div style="display:flex; justify-content:center; align-items:center; gap:.5rem; padding:1.25rem;">
                    @if (Model.PageNumber > 1)
                    {
                        <a asp-page="/Users/Index"
                           asp-route-keyword="@Model.Keyword"
                           asp-route-role="@Model.Role"
                           asp-route-pageNumber="@(Model.PageNumber - 1)"
                           class="btn-secondary-olp btn-sm">‚Üê Tr∆∞·ªõc</a>
                    }

                    @for (int i = 1; i <= Model.TotalPages; i++)
                    {
                        if (i == Model.PageNumber)
                        {
                            <span class="btn-primary-olp btn-sm" style="pointer-events:none;">@i</span>
                        }
                        else
                        {
                            <a asp-page="/Users/Index"
                               asp-route-keyword="@Model.Keyword"
                               asp-route-role="@Model.Role"
                               asp-route-pageNumber="@i"
                               class="btn-secondary-olp btn-sm">@i</a>
                        }
                    }

                    @if (Model.PageNumber < Model.TotalPages)
                    {
                        <a asp-page="/Users/Index"
                           asp-route-keyword="@Model.Keyword"
                           asp-route-role="@Model.Role"
                           asp-route-pageNumber="@(Model.PageNumber + 1)"
                           class="btn-secondary-olp btn-sm">Sau ‚Üí</a>
                    }
                </div>
            }
        }
        else
        {
            <div class="empty-state">
                <div class="empty-icon">üîç</div>
                <h3>Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng</h3>
                <p>Th·ª≠ t√¨m ki·∫øm v·ªõi t·ª´ kh√≥a ho·∫∑c b·ªô l·ªçc kh√°c.</p>
            </div>
        }
    </div>
</div>
