@page
@model OnlineLearningPlatform.RazorPages.Areas.Student.Pages.DashboardModel
@{
    ViewData["Title"] = "Dashboard";
}

<style>
    /* ── Section label ── */
    .stat-section-label {
        font-size: var(--text-xs); font-weight: 600;
        text-transform: uppercase; letter-spacing: .07em;
        color: var(--color-label-2);
        margin-bottom: var(--space-3); margin-top: var(--space-6);
    }
    .stat-section-label:first-of-type { margin-top: 0; }

    /* ── Icon trong stat card ── */
    .stat-card-icon {
        width: 36px; height: 36px; border-radius: var(--radius-sm);
        display: flex; align-items: center; justify-content: center;
        margin-bottom: var(--space-3);
    }
    .stat-card-icon svg { width: 18px; height: 18px; }

    .icon-blue   { background: var(--color-blue-tint);  color: var(--color-blue); }
    .icon-green  { background: var(--color-green-tint); color: var(--color-green); }
    .icon-amber  { background: var(--color-amber-tint); color: var(--color-amber); }
    .icon-purple { background: #f0eeff;                 color: #6b21a8; }

    .stat-sub { font-size: 11px; color: var(--color-label-3); margin-top: 4px; }

    /* ── 2-col grid ── */
    .dash-grid {
        display: grid; grid-template-columns: 1fr 1fr;
        gap: var(--space-5); margin-top: var(--space-5);
    }
    @@media (max-width: 768px) { .dash-grid { grid-template-columns: 1fr; } }

    /* ── Welcome banner ── */
    .welcome-banner {
        background: linear-gradient(135deg, #1d8348 0%, #0071e3 100%);
        border-radius: var(--radius-xl);
        padding: var(--space-8) var(--space-10);
        display: flex; align-items: center; justify-content: space-between;
        gap: var(--space-6); margin-bottom: var(--space-8);
        overflow: hidden; position: relative;
    }
    .welcome-banner::before {
        content: '';
        position: absolute; top: -40px; right: -40px;
        width: 200px; height: 200px; border-radius: 50%;
        background: rgba(255,255,255,.08);
    }
    .welcome-banner::after {
        content: '';
        position: absolute; bottom: -60px; right: 80px;
        width: 150px; height: 150px; border-radius: 50%;
        background: rgba(255,255,255,.05);
    }
    .welcome-text { position: relative; z-index: 1; }
    .welcome-text h2 {
        font-size: var(--text-xl); font-weight: 700;
        color: #fff; letter-spacing: -.03em; margin-bottom: var(--space-2);
    }
    .welcome-text p { font-size: var(--text-sm); color: rgba(255,255,255,.80); }
    .welcome-actions { position: relative; z-index: 1; display: flex; gap: var(--space-3); flex-shrink: 0; }
    .btn-white {
        background: rgba(255,255,255,.18); color: #fff !important;
        border: 1px solid rgba(255,255,255,.30);
        backdrop-filter: blur(8px);
        font-size: var(--text-sm); font-weight: 500;
        border-radius: var(--radius-full); padding: 9px 20px;
        text-decoration: none; display: inline-flex; align-items: center; gap: 6px;
        transition: background var(--transition);
    }
    .btn-white:hover { background: rgba(255,255,255,.28); opacity: 1 !important; }
    .btn-white-solid {
        background: #fff; color: #1d8348 !important;
        font-size: var(--text-sm); font-weight: 600;
        border-radius: var(--radius-full); padding: 9px 20px;
        text-decoration: none; display: inline-flex; align-items: center; gap: 6px;
        transition: opacity var(--transition); border: none;
    }
    .btn-white-solid:hover { opacity: .88 !important; }
    @@media (max-width: 640px) {
        .welcome-banner { flex-direction: column; padding: var(--space-6); }
        .welcome-actions { flex-wrap: wrap; }
    }

    /* ── Course mini-cards ── */
    .course-mini-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        gap: var(--space-4);
    }
    .course-mini-card {
        background: var(--color-surface);
        border: 1px solid var(--color-border-light);
        border-radius: var(--radius-lg);
        overflow: hidden;
        transition: box-shadow var(--transition), transform var(--transition);
        display: flex; flex-direction: column;
    }
    .course-mini-card:hover { box-shadow: var(--shadow-md); transform: translateY(-2px); }
    .course-mini-thumb {
        height: 120px; width: 100%;
        object-fit: cover; background: var(--color-surface-2);
        display: flex; align-items: center; justify-content: center;
        font-size: 40px; flex-shrink: 0;
    }
    .course-mini-body { padding: var(--space-4); flex: 1; display: flex; flex-direction: column; }
    .course-mini-title {
        font-size: var(--text-sm); font-weight: 600; color: var(--color-label-1);
        margin-bottom: 4px;
        overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
    }
    .course-mini-teacher { font-size: 11px; color: var(--color-label-2); margin-bottom: var(--space-3); }

    /* Progress bar */
    .mini-progress-bar {
        background: var(--color-surface-2); border-radius: var(--radius-full);
        height: 5px; overflow: hidden; margin-bottom: 5px;
    }
    .mini-progress-fill {
        height: 100%; border-radius: var(--radius-full);
        background: var(--color-blue); transition: width .5s ease;
    }
    .mini-progress-fill.done { background: var(--color-green); }
    .mini-progress-text {
        display: flex; justify-content: space-between;
        font-size: 11px; color: var(--color-label-2);
        margin-bottom: var(--space-3);
    }
    .mini-progress-text .pct { font-weight: 600; color: var(--color-blue); }
    .mini-progress-text .pct.done { color: var(--color-green); }

    .btn-continue-sm {
        display: block; text-align: center;
        padding: 9px 16px; border-radius: var(--radius-full);
        font-size: var(--text-sm); font-weight: 600;
        text-decoration: none; transition: opacity var(--transition);
        margin-top: auto;
    }
    .btn-continue-sm.blue  { background: var(--color-blue); color: #fff !important; }
    .btn-continue-sm.green { background: var(--color-green-tint); color: var(--color-green) !important; }
    .btn-continue-sm:hover { opacity: .82 !important; }

    .empty-state {
        text-align: center; padding: var(--space-10) var(--space-6);
        color: var(--color-label-2); font-size: var(--text-sm);
    }

    @@keyframes fadeInUp {
        from { opacity: 0; transform: translateY(12px); }
        to   { opacity: 1; transform: translateY(0); }
    }
    .fade-up { animation: fadeInUp .4s cubic-bezier(.25,.46,.45,.94) both; }
    .delay-1 { animation-delay: .06s; }
    .delay-2 { animation-delay: .12s; }
    .delay-3 { animation-delay: .18s; }
</style>

@* ── PAGE HEADER ── *@
<div class="page-head fade-up">
    <h1>Dashboard</h1>
    <div class="breadcrumb">
        <span>Học viên</span>
        <span class="breadcrumb-sep">›</span>
        <span>Tổng quan</span>
    </div>
</div>

@* ── WELCOME BANNER ── *@
<div class="welcome-banner fade-up delay-1">
    <div class="welcome-text">
        <h2>Xin chào, @(Model.UserInfo?.FullName ?? "Bạn") 👋</h2>
        <p>Tiếp tục hành trình học tập — mỗi bài học đưa bạn đến gần mục tiêu hơn.</p>
    </div>
    <div class="welcome-actions">
        <a asp-area="Student" asp-page="/MyLearning" class="btn-white-solid">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
            Xem khóa học của tôi
        </a>
        <a asp-area="Student" asp-page="/Profile" class="btn-white">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            Hồ sơ của tôi
        </a>
    </div>
</div>

@* ── STATS ── *@
<p class="stat-section-label fade-up delay-2">Tiến độ học tập</p>
<div class="stat-grid fade-up delay-2">

    <div class="stat-card">
        <div class="stat-card-icon icon-blue">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
            </svg>
        </div>
        <div class="stat-label">Khóa học đã đăng ký</div>
        <div class="stat-value">@Model.TotalEnrolled</div>
        <div class="stat-sub">Tổng số khóa học của bạn</div>
    </div>

    <div class="stat-card">
        <div class="stat-card-icon icon-green">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20 6 9 17 4 12"/>
            </svg>
        </div>
        <div class="stat-label">Đã hoàn thành</div>
        <div class="stat-value">@Model.CompletedCourses</div>
        <div class="stat-sub">Khóa học hoàn thành 100%</div>
    </div>

    <div class="stat-card">
        <div class="stat-card-icon icon-amber">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
            </svg>
        </div>
        <div class="stat-label">Đang học</div>
        <div class="stat-value">@Model.InProgressCourses</div>
        <div class="stat-sub">Khóa học đang tiến hành</div>
    </div>

    <div class="stat-card">
        <div class="stat-card-icon icon-purple">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="8" r="6"/>
                <path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"/>
            </svg>
        </div>
        <div class="stat-label">Chứng chỉ</div>
        <div class="stat-value">@Model.CompletedCourses</div>
        <div class="stat-sub">Khóa học đã nhận chứng chỉ</div>
    </div>

</div>

@* ── ROW: Recent courses + Quick Access ── *@
<div class="dash-grid fade-up delay-3">

    @* Khóa học đang học *@
    <div class="card">
        <div class="card-header">
            <h2>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline;margin-right:6px;vertical-align:-2px;color:var(--color-blue)">
                    <path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                </svg>
                Tiếp tục học
            </h2>
            <a asp-area="Student" asp-page="/MyLearning" class="btn btn-sm btn-secondary">Xem tất cả</a>
        </div>
        <div class="card-body">
            @if (!Model.RecentCourses.Any())
            {
                <div class="empty-state">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="margin:0 auto var(--space-3)">
                        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                    </svg>
                    <p>Bạn chưa đăng ký khóa học nào.</p>
                </div>
            }
            else
            {
                <div class="course-mini-grid">
                    @foreach (var item in Model.RecentCourses)
                    {
                        bool isDone = item.Progress?.IsCompleted ?? false;
                        int pct = (int)(item.Progress?.PercentComplete ?? 0);
                        string learnUrl = $"/Student/LearnCourse?courseId={item.CourseId}{(item.ResumeLessonId.HasValue ? $"&lessonId={item.ResumeLessonId}" : "")}";
                        <div class="course-mini-card">
                            @if (!string.IsNullOrEmpty(item.ThumbnailUrl))
                            {
                                <img src="@item.ThumbnailUrl" alt="@item.Title" class="course-mini-thumb" style="display:block" />
                            }
                            else
                            {
                                <div class="course-mini-thumb">📚</div>
                            }
                            <div class="course-mini-body">
                                <div class="course-mini-title" title="@item.Title">@item.Title</div>
                                <div class="course-mini-teacher">@item.TeacherName</div>
                                <div class="mini-progress-bar">
                                    <div class="mini-progress-fill @(isDone ? "done" : "")" style="width:@pct%"></div>
                                </div>
                                <div class="mini-progress-text">
                                    <span>@(item.Progress?.CompletedLessons ?? 0)/@(item.Progress?.TotalLessons ?? 0) bài</span>
                                    <span class="pct @(isDone ? "done" : "")">@pct%</span>
                                </div>
                                @if (isDone)
                                {
                                    <a href="@learnUrl" class="btn-continue-sm green">✓ Xem lại</a>
                                }
                                else
                                {
                                    <a href="@learnUrl" class="btn-continue-sm blue">▶ Tiếp tục học</a>
                                }
                            </div>
                        </div>
                    }
                </div>
            }
        </div>
    </div>

    @* Quick Access *@
    <div class="card">
        <div class="card-header">
            <h2>Truy cập nhanh</h2>
        </div>
        <div class="card-body">
            <div class="quick-grid" style="grid-template-columns:1fr 1fr;gap:var(--space-3);">

                <a asp-area="Student" asp-page="/MyLearning" class="quick-item">
                    <div class="quick-item-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                        </svg>
                    </div>
                    <div class="quick-item-title">Khóa học của tôi</div>
                    <div class="quick-item-desc">Xem và tiếp tục các khóa học</div>
                </a>

                <a asp-area="Student" asp-page="/Profile" class="quick-item">
                    <div class="quick-item-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                    </div>
                    <div class="quick-item-title">Hồ sơ cá nhân</div>
                    <div class="quick-item-desc">Xem và chỉnh sửa thông tin</div>
                </a>

                <a asp-area="Student" asp-page="/EditProfile" class="quick-item">
                    <div class="quick-item-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                        </svg>
                    </div>
                    <div class="quick-item-title">Chỉnh sửa hồ sơ</div>
                    <div class="quick-item-desc">Cập nhật ảnh đại diện, bio...</div>
                </a>

                <a asp-area="Student" asp-page="/Certificates/Index" class="quick-item">
                    <div class="quick-item-icon" style="background:var(--color-green-tint); color:var(--color-green)">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="8" r="6"/>
                            <path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"/>
                        </svg>
                    </div>
                    <div class="quick-item-title">Chứng chỉ</div>
                    <div class="quick-item-desc">Xem tất cả chứng chỉ</div>
                </a>

            </div>
        </div>
    </div>

</div>