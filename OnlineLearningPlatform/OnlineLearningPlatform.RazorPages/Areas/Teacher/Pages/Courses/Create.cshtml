@page
@model OnlineLearningPlatform.RazorPages.Areas.Teacher.Pages.Courses.CreateModel
@using OnlineLearningPlatform.Models.Entities
@{
    ViewData["Title"] = "T·∫°o kh√≥a h·ªçc m·ªõi";
}

<style>
/* ‚îÄ‚îÄ Wizard layout ‚îÄ‚îÄ */
.wizard-wrap {
    max-width: 860px; margin: 0 auto;
}

/* ‚îÄ‚îÄ Step pills ‚îÄ‚îÄ */
.step-pills {
    display: flex; align-items: center; justify-content: center;
    gap: 0; margin-bottom: var(--space-8); position: relative;
}
.step-pills::before {
    content: '';
    position: absolute; top: 16px; left: 10%; right: 10%; height: 2px;
    background: var(--color-border-light); z-index: 0;
}
.step-pill {
    display: flex; flex-direction: column; align-items: center;
    flex: 1; position: relative; z-index: 1; cursor: pointer;
    background: none; border: none; gap: var(--space-2);
}
.step-pill-num {
    width: 32px; height: 32px; border-radius: 50%;
    border: 2px solid var(--color-border);
    background: var(--color-surface);
    display: flex; align-items: center; justify-content: center;
    font-size: var(--text-xs); font-weight: 700; color: var(--color-label-2);
    transition: all .25s ease;
}
.step-pill-label {
    font-size: 11px; font-weight: 500; color: var(--color-label-2);
    white-space: nowrap; text-align: center;
}
.step-pill.active .step-pill-num  { background: var(--color-blue); border-color: var(--color-blue); color: #fff; }
.step-pill.active .step-pill-label { color: var(--color-blue); font-weight: 600; }
.step-pill.done  .step-pill-num   { background: var(--color-green); border-color: var(--color-green); color: #fff; }
.step-pill.done  .step-pill-label { color: var(--color-green); }

/* ‚îÄ‚îÄ Panels ‚îÄ‚îÄ */
.step-panel { display: none; }
.step-panel.active { display: block; animation: fadeUp .3s ease forwards; }

.panel-head { margin-bottom: var(--space-6); }
.panel-head h2 {
    font-size: var(--text-lg); font-weight: 700;
    letter-spacing: -.025em; color: var(--color-label-1);
    display: flex; align-items: center; gap: var(--space-3); margin-bottom: 6px;
}
.panel-head h2 .step-emoji { font-size: 22px; }
.panel-head p { font-size: var(--text-sm); color: var(--color-label-2); }

/* ‚îÄ‚îÄ Field helpers ‚îÄ‚îÄ */
.field-row-2 { display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-4); }
@@media(max-width:640px){ .field-row-2 { grid-template-columns: 1fr; } }
.field-group { margin-bottom: var(--space-5); }
.field-label {
    display: block; font-size: var(--text-sm); font-weight: 500;
    color: var(--color-label-1); margin-bottom: var(--space-2);
}
.field-label .req { color: var(--color-red); }
.field-hint { display: block; font-size: var(--text-xs); color: var(--color-label-2); margin-top: 6px; }

/* ‚îÄ‚îÄ Price toggle ‚îÄ‚îÄ */
.price-type-row {
    display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-3);
    margin-bottom: var(--space-5);
}
.price-type-card {
    border: 2px solid var(--color-border); border-radius: var(--radius-lg);
    padding: var(--space-4); cursor: pointer; transition: all .2s ease;
    background: var(--color-surface); display: flex; align-items: center; gap: var(--space-3);
}
.price-type-card:hover { border-color: var(--color-blue); }
.price-type-card.selected { border-color: var(--color-blue); background: var(--color-blue-tint); }
.price-type-card input[type=radio] { display: none; }
.price-type-icon { font-size: 24px; }
.price-type-text strong { display: block; font-size: var(--text-sm); font-weight: 600; color: var(--color-label-1); }
.price-type-text span { font-size: var(--text-xs); color: var(--color-label-2); }

/* ‚îÄ‚îÄ Thumbnail upload ‚îÄ‚îÄ */
.thumb-zone {
    border: 2px dashed var(--color-border); border-radius: var(--radius-lg);
    padding: var(--space-8); text-align: center; cursor: pointer;
    transition: border-color .2s ease, background .2s ease; position: relative;
}
.thumb-zone:hover { border-color: var(--color-blue); background: var(--color-blue-tint); }
.thumb-zone input[type=file] { position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; }
.thumb-zone-icon { font-size: 32px; margin-bottom: var(--space-2); }
.thumb-zone p { font-size: var(--text-sm); color: var(--color-label-2); }
.thumb-zone strong { color: var(--color-blue); }
#thumbPreview { margin-top: var(--space-3); border-radius: var(--radius-lg); overflow: hidden; display: none; }
#thumbPreview img { width: 100%; max-height: 220px; object-fit: cover; display: block; border-radius: var(--radius-lg); }

/* ‚îÄ‚îÄ Step footer ‚îÄ‚îÄ */
.step-footer {
    display: flex; justify-content: space-between; align-items: center;
    margin-top: var(--space-8); padding-top: var(--space-5);
    border-top: 1px solid var(--color-border-light);
}
.step-footer-end { display: flex; gap: var(--space-3); }

/* ‚îÄ‚îÄ Review summary ‚îÄ‚îÄ */
.review-grid {
    display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-3);
    margin-bottom: var(--space-5);
}
@@media(max-width:600px){ .review-grid { grid-template-columns: 1fr; } }
.review-cell { background: var(--color-surface-2); border-radius: var(--radius); padding: var(--space-4); }
.review-cell-label { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: .06em; color: var(--color-label-2); margin-bottom: 4px; }
.review-cell-value { font-size: var(--text-sm); font-weight: 600; color: var(--color-label-1); word-break: break-word; }
</style>

<div class="wizard-wrap fade-up">

    <div class="page-head">
        <h1>T·∫°o kh√≥a h·ªçc m·ªõi</h1>
        <div class="breadcrumb">
            <a asp-area="Teacher" asp-page="/Dashboard">Dashboard</a>
            <span class="breadcrumb-sep">‚Ä∫</span>
            <a asp-area="Teacher" asp-page="/Courses/Index">Kh√≥a h·ªçc</a>
            <span class="breadcrumb-sep">‚Ä∫</span>
            <span>T·∫°o m·ªõi</span>
        </div>
    </div>

    <!-- Step pills indicator -->
    <div class="step-pills" id="stepPills">
        <button type="button" class="step-pill active" data-goto="1">
            <span class="step-pill-num" id="num1">1</span>
            <span class="step-pill-label">Th√¥ng tin c∆° b·∫£n</span>
        </button>
        <button type="button" class="step-pill" data-goto="2">
            <span class="step-pill-num" id="num2">2</span>
            <span class="step-pill-label">Danh m·ª•c & Tr√¨nh ƒë·ªô</span>
        </button>
        <button type="button" class="step-pill" data-goto="3">
            <span class="step-pill-num" id="num3">3</span>
            <span class="step-pill-label">Gi√° & H√¨nh ·∫£nh</span>
        </button>
    </div>

    <!-- Server validation errors -->
    <div asp-validation-summary="All" class="alert alert-danger" id="serverErrors"></div>

    <form method="post" id="courseForm">

        <!-- ‚ïê‚ïê‚ïê STEP 1: Basic Info ‚ïê‚ïê‚ïê -->
        <div class="step-panel card active" id="panel1">
            <div class="card-body">
                <div class="panel-head">
                    <h2><span class="step-emoji">üìù</span> Th√¥ng tin c∆° b·∫£n</h2>
                    <p>Ti√™u ƒë·ªÅ, m√£ v√† m√¥ t·∫£ gi√∫p h·ªçc vi√™n hi·ªÉu r√µ kh√≥a h·ªçc c·ªßa b·∫°n.</p>
                </div>

                <div class="field-group">
                    <label class="field-label" for="Input_Title">
                        Ti√™u ƒë·ªÅ kh√≥a h·ªçc <span class="req">*</span>
                    </label>
                    <input asp-for="Input.Title" id="Input_Title" class="form-control"
                           placeholder="VD: L·∫≠p tr√¨nh React t·ª´ c∆° b·∫£n ƒë·∫øn n√¢ng cao" />
                    <span class="field-hint">Ng·∫Øn g·ªçn, h·∫•p d·∫´n ‚Äî n√™u r√µ gi√° tr·ªã b·∫°n mang l·∫°i.</span>
                    <span asp-validation-for="Input.Title" class="form-error"></span>
                </div>

                <div class="field-row-2">
                    <div class="field-group" style="margin-bottom:0">
                        <label class="field-label" for="Input_CourseCode">
                            M√£ kh√≥a h·ªçc <span class="req">*</span>
                        </label>
                        <input asp-for="Input.CourseCode" id="Input_CourseCode" class="form-control"
                               placeholder="VD: REACT101" maxlength="20" />
                        <span class="field-hint">Vi·∫øt hoa, kh√¥ng d·∫•u, t·ªëi ƒëa 20 k√Ω t·ª±.</span>
                        <span asp-validation-for="Input.CourseCode" class="form-error"></span>
                    </div>
                    <div class="field-group" style="margin-bottom:0">
                        <label class="field-label" for="Input_Slug">
                            ƒê∆∞·ªùng d·∫´n (Slug) <span class="req">*</span>
                        </label>
                        <input asp-for="Input.Slug" id="Input_Slug" class="form-control"
                               placeholder="VD: lap-trinh-react-co-ban" maxlength="220" />
                        <span class="field-hint">T·ª± ƒë·ªông t·∫°o t·ª´ ti√™u ƒë·ªÅ. Ch·ªâ d√πng a-z, 0-9, d·∫•u -.</span>
                        <span asp-validation-for="Input.Slug" class="form-error"></span>
                    </div>
                </div>

                <div class="field-group" style="margin-top:var(--space-5)">
                    <label class="field-label" for="Input_Description">M√¥ t·∫£ kh√≥a h·ªçc</label>
                    <textarea asp-for="Input.Description" id="Input_Description" class="form-control"
                              rows="5" placeholder="M√¥ t·∫£ nh·ªØng g√¨ h·ªçc vi√™n s·∫Ω h·ªçc ƒë∆∞·ª£c, ƒë·ªëi t∆∞·ª£ng ph√π h·ª£p, y√™u c·∫ßu ƒë·∫ßu v√†o..."></textarea>
                    <span class="field-hint">M√¥ t·∫£ t·ªët gi√∫p tƒÉng t·ª∑ l·ªá ƒëƒÉng k√Ω ƒë√°ng k·ªÉ.</span>
                </div>

                <div class="step-footer">
                    <a asp-area="Teacher" asp-page="/Courses/Index" class="btn btn-secondary">H·ªßy</a>
                    <div class="step-footer-end">
                        <button type="button" class="btn btn-primary" id="nextTo2" onclick="gotoStep(2)">
                            Ti·∫øp theo
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê STEP 2: Category & Level ‚ïê‚ïê‚ïê -->
        <div class="step-panel card" id="panel2">
            <div class="card-body">
                <div class="panel-head">
                    <h2><span class="step-emoji">üè∑Ô∏è</span> Danh m·ª•c & Tr√¨nh ƒë·ªô</h2>
                    <p>Gi√∫p h·ªçc vi√™n t√¨m ki·∫øm ƒë√∫ng kh√≥a h·ªçc ph√π h·ª£p v·ªõi h·ªç.</p>
                </div>

                <div class="field-group">
                    <label class="field-label" for="Input_CategoryId">Danh m·ª•c</label>
                    <select asp-for="Input.CategoryId" id="Input_CategoryId" class="form-control">
                        <option value="">-- Ch·ªçn danh m·ª•c --</option>
                        @foreach (var cat in Model.Categories)
                        {
                            <option value="@cat.CategoryId">@cat.CategoryName</option>
                        }
                    </select>
                    <span class="field-hint">
                        Kh√¥ng t√¨m th·∫•y danh m·ª•c ph√π h·ª£p?
                        <a asp-area="Teacher" asp-page="/Categories/Create" target="_blank" style="font-weight:500">
                            T·∫°o danh m·ª•c m·ªõi ‚Üó
                        </a>
                    </span>
                </div>

                <div class="field-row-2">
                    <div class="field-group" style="margin-bottom:0">
                        <label class="field-label" for="Input_Level">Tr√¨nh ƒë·ªô</label>
                        <select asp-for="Input.Level" id="Input_Level" class="form-control"
                                asp-items="Html.GetEnumSelectList<CourseLevel>()"></select>
                        <span class="field-hint">Beginner = C∆° b·∫£n ¬∑ Intermediate = Trung c·∫•p ¬∑ Advanced = N√¢ng cao.</span>
                    </div>
                    <div class="field-group" style="margin-bottom:0">
                        <label class="field-label" for="Input_Language">Ng√¥n ng·ªØ gi·∫£ng d·∫°y</label>
                        <input asp-for="Input.Language" id="Input_Language" class="form-control"
                               placeholder="vi" maxlength="10" />
                        <span class="field-hint">vi = Ti·∫øng Vi·ªát, en = English.</span>
                    </div>
                </div>

                <div class="step-footer">
                    <button type="button" class="btn btn-secondary" onclick="gotoStep(1)">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
                        Quay l·∫°i
                    </button>
                    <div class="step-footer-end">
                        <button type="button" class="btn btn-primary" onclick="gotoStep(3)">
                            Ti·∫øp theo
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê STEP 3: Price & Thumbnail ‚ïê‚ïê‚ïê -->
        <div class="step-panel card" id="panel3">
            <div class="card-body">
                <div class="panel-head">
                    <h2><span class="step-emoji">üí∞</span> H·ªçc ph√≠ & H√¨nh ·∫£nh</h2>
                    <p>ƒê·∫∑t gi√° v√† th√™m ·∫£nh b√¨a thu h√∫t. B·∫°n c√≥ th·ªÉ c·∫≠p nh·∫≠t sau.</p>
                </div>

                <!-- Price type -->
                <div class="field-group">
                    <label class="field-label">Lo·∫°i h·ªçc ph√≠</label>
                    <div class="price-type-row">
                        <label class="price-type-card selected" id="cardFree">
                            <input type="radio" name="_priceType" value="free" checked onchange="setPriceType('free')" />
                            <span class="price-type-icon">üéÅ</span>
                            <div class="price-type-text">
                                <strong>Mi·ªÖn ph√≠</strong>
                                <span>M·ªü cho t·∫•t c·∫£ h·ªçc vi√™n</span>
                            </div>
                        </label>
                        <label class="price-type-card" id="cardPaid">
                            <input type="radio" name="_priceType" value="paid" onchange="setPriceType('paid')" />
                            <span class="price-type-icon">üí≥</span>
                            <div class="price-type-text">
                                <strong>C√≥ ph√≠</strong>
                                <span>Thu h·ªçc ph√≠ t·ª´ h·ªçc vi√™n</span>
                            </div>
                        </label>
                    </div>
                </div>

                <div id="paidFields" style="display:none">
                    <div class="field-row-2">
                        <div class="field-group">
                            <label class="field-label" for="Input_Price">Gi√° g·ªëc (VNƒê)</label>
                            <input asp-for="Input.Price" id="Input_Price" class="form-control"
                                   type="number" min="0" step="1000" placeholder="VD: 299000" />
                            <span asp-validation-for="Input.Price" class="form-error"></span>
                        </div>
                        <div class="field-group">
                            <label class="field-label" for="Input_DiscountPrice">Gi√° khuy·∫øn m√£i (VNƒê)</label>
                            <input asp-for="Input.DiscountPrice" id="Input_DiscountPrice" class="form-control"
                                   type="number" min="0" step="1000" placeholder="ƒê·ªÉ tr·ªëng n·∫øu kh√¥ng gi·∫£m" />
                            <span asp-validation-for="Input.DiscountPrice" class="form-error"></span>
                        </div>
                    </div>
                </div>
                <!-- Hidden price = 0 for free courses -->
                <input asp-for="Input.Price" id="hiddenPrice" type="hidden" value="0" />

                <!-- Thumbnail -->
                <div class="field-group">
                    <label class="field-label">·∫¢nh b√¨a kh√≥a h·ªçc</label>
                    <div class="thumb-zone" id="thumbZone">
                        <input type="file" id="thumbFile" accept="image/*" onchange="previewFile(this)" />
                        <div class="thumb-zone-icon">üñºÔ∏è</div>
                        <p><strong>Nh·∫•n ƒë·ªÉ ch·ªçn ·∫£nh</strong> ho·∫∑c nh·∫≠p URL b√™n d∆∞·ªõi</p>
                        <p style="font-size:11px;margin-top:4px;color:var(--color-label-3)">PNG, JPG, WebP ¬∑ Khuy·∫øn ngh·ªã 1280√ó720px</p>
                    </div>
                    <div id="thumbPreview">
                        <img id="thumbImg" src="" alt="Preview" />
                        <button type="button" class="btn btn-secondary btn-sm" onclick="clearThumb()" style="margin-top:8px">
                            X√≥a ·∫£nh
                        </button>
                    </div>
                    <div style="margin-top:var(--space-3)">
                        <label class="field-label" style="font-size:var(--text-xs)">Ho·∫∑c nh·∫≠p URL ·∫£nh b√¨a</label>
                        <input asp-for="Input.ThumbnailUrl" id="Input_ThumbnailUrl" class="form-control"
                               placeholder="https://..." oninput="previewUrl(this.value)" style="font-size:var(--text-sm)" />
                    </div>
                </div>

                <div class="step-footer">
                    <button type="button" class="btn btn-secondary" onclick="gotoStep(2)">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
                        Quay l·∫°i
                    </button>
                    <div class="step-footer-end">
                        <a asp-area="Teacher" asp-page="/Courses/Index" class="btn btn-secondary">H·ªßy</a>
                        <button type="submit" class="btn btn-primary" id="btnSubmit">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                            T·∫°o kh√≥a h·ªçc
                        </button>
                    </div>
                </div>

                <div class="alert alert-info" style="margin-top:var(--space-5);margin-bottom:0">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                    <span>Sau khi t·∫°o xong, b·∫°n s·∫Ω ƒë∆∞·ª£c chuy·ªÉn ƒë·∫øn trang <strong>Qu·∫£n l√Ω n·ªôi dung</strong> ƒë·ªÉ th√™m sections v√† lessons.</span>
                </div>
            </div>
        </div>

    </form>
</div>

@section Scripts {
<partial name="_ValidationScriptsPartial" />
<script>
(function () {
    /* ‚îÄ‚îÄ Step navigation ‚îÄ‚îÄ */
    let current = 1;
    const TOTAL = 3;

    window.gotoStep = function (n) {
        if (n < 1 || n > TOTAL) return;
        document.querySelectorAll('.step-panel').forEach(p => p.classList.remove('active'));
        document.getElementById('panel' + n).classList.add('active');

        document.querySelectorAll('.step-pill').forEach(function (pill, idx) {
            const s = idx + 1;
            pill.classList.remove('active', 'done');
            if (s === n) pill.classList.add('active');
            else if (s < n) pill.classList.add('done');
            // Show checkmark for done steps
            const numEl = document.getElementById('num' + s);
            if (numEl) {
                if (s < n) numEl.innerHTML = '‚úì';
                else numEl.textContent = s;
            }
        });

        current = n;
        window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    // Allow clicking step pills to navigate
    document.querySelectorAll('.step-pill').forEach(function (pill) {
        pill.addEventListener('click', function () {
            const t = parseInt(this.dataset.goto);
            gotoStep(t);
        });
    });

    /* ‚îÄ‚îÄ Slug auto-generation ‚îÄ‚îÄ */
    const titleEl = document.getElementById('Input_Title');
    const slugEl  = document.getElementById('Input_Slug');
    const codeEl  = document.getElementById('Input_CourseCode');

    function toSlug(s) {
        const map = {√†:'a',√°:'a',·∫£:'a',√£:'a',·∫°:'a',ƒÉ:'a',·∫Ø:'a',·∫±:'a',·∫≥:'a',·∫µ:'a',·∫∑:'a',√¢:'a',·∫•:'a',·∫ß:'a',·∫©:'a',·∫´:'a',·∫≠:'a',√®:'e',√©:'e',·∫ª:'e',·∫Ω:'e',·∫π:'e',√™:'e',·∫ø:'e',·ªÅ:'e',·ªÉ:'e',·ªÖ:'e',·ªá:'e',√¨:'i',√≠:'i',·ªâ:'i',ƒ©:'i',·ªã:'i',√≤:'o',√≥:'o',·ªè:'o',√µ:'o',·ªç:'o',√¥:'o',·ªë:'o',·ªì:'o',·ªï:'o',·ªó:'o',·ªô:'o',∆°:'o',·ªõ:'o',·ªù:'o',·ªü:'o',·ª°:'o',·ª£:'o',√π:'u',√∫:'u',·ªß:'u',≈©:'u',·ª•:'u',∆∞:'u',·ª©:'u',·ª´:'u',·ª≠:'u',·ªØ:'u',·ª±:'u',·ª≥:'y',√Ω:'y',·ª∑:'y',·ªπ:'y',·ªµ:'y',ƒë:'d'};
        return s.toLowerCase().split('').map(c => map[c] || c).join('')
            .replace(/[^a-z0-9\s-]/g,'').trim().replace(/\s+/g,'-').replace(/-+/g,'-');
    }

    titleEl?.addEventListener('input', function () {
        if (!slugEl.dataset.edited) {
            slugEl.value = toSlug(this.value);
        }
        if (!codeEl.value) {
            const words = this.value.toUpperCase().split(/\s+/).filter(Boolean);
            if (words.length > 0) {
                codeEl.placeholder = words.map(w => w[0]).join('').substring(0, 6) || 'CODE';
            }
        }
    });
    slugEl?.addEventListener('input', function () { this.dataset.edited = '1'; });

    /* ‚îÄ‚îÄ Price type toggle ‚îÄ‚îÄ */
    window.setPriceType = function (type) {
        const cardFree = document.getElementById('cardFree');
        const cardPaid = document.getElementById('cardPaid');
        const paidFields = document.getElementById('paidFields');
        const hiddenPrice = document.getElementById('hiddenPrice');
        const inputPrice = document.getElementById('Input_Price');

        if (type === 'free') {
            cardFree.classList.add('selected');
            cardPaid.classList.remove('selected');
            paidFields.style.display = 'none';
            hiddenPrice.disabled = false;
            hiddenPrice.value = '0';
            if (inputPrice) inputPrice.disabled = true;
        } else {
            cardPaid.classList.add('selected');
            cardFree.classList.remove('selected');
            paidFields.style.display = '';
            hiddenPrice.disabled = true;
            if (inputPrice) inputPrice.disabled = false;
        }
    };
    // Init
    setPriceType('free');

    /* ‚îÄ‚îÄ Thumbnail ‚îÄ‚îÄ */
    window.previewFile = function (input) {
        if (!input.files || !input.files[0]) return;
        const reader = new FileReader();
        reader.onload = function (e) {
            document.getElementById('thumbImg').src = e.target.result;
            document.getElementById('thumbPreview').style.display = 'block';
            document.getElementById('thumbZone').style.display = 'none';
            document.getElementById('Input_ThumbnailUrl').value = '';
        };
        reader.readAsDataURL(input.files[0]);
    };
    window.previewUrl = function (url) {
        if (url && url.startsWith('http')) {
            document.getElementById('thumbImg').src = url;
            document.getElementById('thumbPreview').style.display = 'block';
            document.getElementById('thumbZone').style.display = 'none';
        }
    };
    window.clearThumb = function () {
        document.getElementById('thumbImg').src = '';
        document.getElementById('thumbPreview').style.display = 'none';
        document.getElementById('thumbZone').style.display = 'block';
        document.getElementById('thumbFile').value = '';
        document.getElementById('Input_ThumbnailUrl').value = '';
    };

    /* ‚îÄ‚îÄ Submit: ensure correct price field is sent ‚îÄ‚îÄ */
    document.getElementById('courseForm').addEventListener('submit', function () {
        const btn = document.getElementById('btnSubmit');
        btn.disabled = true;
        btn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/></svg> ƒêang t·∫°o...';
    });

    /* ‚îÄ‚îÄ If server returned errors, go back to step 1 ‚îÄ‚îÄ */
    const errBox = document.getElementById('serverErrors');
    if (errBox && errBox.textContent.trim().length > 0) {
        gotoStep(1);
    }
})();
</script>
}
